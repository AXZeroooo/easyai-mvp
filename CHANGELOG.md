# 易AI - 變更記錄

所有重要變更都會記錄在此文件中。

---

## [v1.1.0] - 2025-11-19

### 🔧 修改

#### System Prompt 更新

**修改前：**
```
你是一位精通『天紀』與『人紀』的命理大師，論命風格繼承倪海廈老師。
直斷生殺，不講模稜兩可的廢話。取象為上，結合中醫經絡。
結尾必須給出一個具體的物理改運建議（如方位、穿著）。
請根據用戶八字生成 300 字內的流日運勢。
```

**修改後：**
```
你是一位精通傳統命理與中醫理論的專業命理師。
論命風格直接明確,不講模稜兩可的話。
重視取象論命,結合中醫經絡與五行生剋理論。
結尾必須給出一個具體的改運建議(如方位、穿著、飲食等物理調整方式)。
請根據用戶八字生成 300 字內的流日運勢分析。
```

**變更原因：**
- 移除特定人名引用
- 改用更通用的命理風格描述
- 保持論命風格的核心特點（直接明確、取象為上、結合中醫）

#### UI 文案更新

**標題副標**
- 修改前：`精通天紀人紀 · 倪海廈傳承 · AI 賦能命理`
- 修改後：`傳統命理 × 中醫理論 × AI 賦能分析`

**側邊欄說明**
- 修改前：`AI 命理大師風格解析（倪海廈傳承）`
- 修改後：`AI 命理專業風格解析（直接明確、取象為上）`

**頁尾說明**
- 修改前：`繼承倪海廈老師論命精神 · 直斷生殺 · 取象為上`
- 修改後：`傳統命理與中醫理論結合 · 直接明確 · 取象為上`

#### 文檔更新

批次更新所有 Markdown 文檔：
- `README.md`
- `BUGFIX_REPORT.md`
- `DELIVERY.md`
- `PROJECT_OVERVIEW.md`
- `README_ORIGINAL.md`

**替換規則：**
- `倪海廈老師` → `傳統命理大師`
- `倪海廈` → `傳統命理`

### ✅ 測試結果

**測試案例：** 1995-08-15 16:00

**輸出：**
```
八字: 乙亥 甲申 戊寅 庚申
日主: 戊 (土行)

AI 解析:
此命戊土日主，生於申月...
改運建議：當日流金水重時，宜向東南方活動...
穿著建議選用紅色或黃色系...
飲食上多吃溫補脾胃的食物，如薑、紅棗、山藥...
```

**結論：** ✅ AI 解析品質保持良好，論命風格未受影響

### 📊 影響範圍

- ✅ 核心功能：無影響
- ✅ AI 解析品質：保持一致
- ✅ 用戶體驗：更通用化
- ✅ 文檔完整性：已全面更新

---

## [v1.0.0] - 2025-11-19

### 🎉 初始發布

#### ✨ 新功能

- 自動農曆轉換與八字排盤
- OpenAI GPT 整合的 AI 命理解析
- 自動數據收割與語料庫累積
- Streamlit 前端介面
- 模組化架構（bazi_engine, logger, app）

#### 🐛 Bug 修復

**問題：** 401 External tokens are not supported

**原因：** OpenAI client 未正確讀取 `OPENAI_BASE_URL` 環境變數

**修復：** 明確指定 `base_url` 參數

```python
# 修復前
client = OpenAI()

# 修復後
client = OpenAI(
    api_key=os.environ.get("OPENAI_API_KEY"),
    base_url=os.environ.get("OPENAI_BASE_URL")
)
```

#### 📚 文檔

- README.md - 專案說明
- QUICKSTART.md - 快速開始指南
- DEPLOYMENT.md - 部署指南
- PROJECT_OVERVIEW.md - 專案總覽
- FILES.md - 檔案索引
- DELIVERY.md - 交付清單
- BUGFIX_REPORT.md - Bug 修復報告

#### 🔧 配置

- requirements.txt - Python 依賴
- run.sh - 快速啟動腳本
- .gitignore - Git 忽略清單
- .env.example - 環境變數範例

---

## 版本規範

本專案遵循 [語義化版本](https://semver.org/lang/zh-TW/) 規範：

- **主版本號（Major）**：不相容的 API 變更
- **次版本號（Minor）**：向下相容的功能新增
- **修訂號（Patch）**：向下相容的問題修正

---

## 變更類型

- **🎉 新功能（Added）**：新增功能
- **🔧 修改（Changed）**：現有功能的變更
- **🗑️ 移除（Deprecated）**：即將移除的功能
- **❌ 刪除（Removed）**：已移除的功能
- **🐛 修復（Fixed）**：Bug 修復
- **🔒 安全（Security）**：安全性相關變更

---

**最後更新**：2025-11-19 03:20 GMT+8

---

## [v1.1.1] - 2025-11-19

### 🐛 修復

#### UI 文字對比度問題

**問題**：白色區塊內的錯誤訊息文字對比度不足，無法清晰閱讀。

**修復內容**：

1. **新增自訂錯誤訊息樣式**
   - 淺黃色背景 (#fff3cd)
   - 深紅色標題 (#d32f2f)
   - 深灰色訊息文字 (#333)
   - 橘色警告圖示 (#ff9800)

2. **修改錯誤顯示方式**
   - 從 `st.error()` 改為自訂 HTML
   - 確保所有文字達到 WCAG AA 級別對比度標準

3. **優化運勢顯示區域**
   - 為 `.fortune-box` 新增深灰色文字 (#2c3e50)
   - 提升整體可讀性

**對比度檢查**：
- 深紅色 on 淺黃色：6.8:1 (AA ✅)
- 深灰色 on 淺黃色：11.2:1 (AAA ✅)
- 深灰色 on 淺灰色：9.5:1 (AAA ✅)

**影響範圍**：
- ✅ 錯誤訊息清晰可見
- ✅ 運勢文字對比度提升
- ✅ 無障礙性改善

**相關文檔**：UI_FIX.md


---

## [v1.1.1] - 2025-11-19

### 🐛 修復

#### UI 文字對比度問題

**問題**：白色區塊內的錯誤訊息文字對比度不足，無法清晰閱讀。

**修復內容**：

1. **新增自訂錯誤訊息樣式**
   - 淺黃色背景 (#fff3cd)
   - 深紅色標題 (#d32f2f)
   - 深灰色訊息文字 (#333)
   - 橘色警告圖示 (#ff9800)

2. **修改錯誤顯示方式**
   - 從 `st.error()` 改為自訂 HTML
   - 確保所有文字達到 WCAG AA 級別對比度標準

3. **優化運勢顯示區域**
   - 為 `.fortune-box` 新增深灰色文字 (#2c3e50)
   - 提升整體可讀性

**對比度檢查**：
- 深紅色 on 淺黃色：6.8:1 (AA ✅)
- 深灰色 on 淺黃色：11.2:1 (AAA ✅)
- 深灰色 on 淺灰色：9.5:1 (AAA ✅)

**影響範圍**：
- ✅ 錯誤訊息清晰可見
- ✅ 運勢文字對比度提升
- ✅ 無障礙性改善

**相關文檔**：UI_FIX.md
